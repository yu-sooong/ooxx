(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();function f(n){const o=[[[0,0],[0,1],[0,2]],[[1,0],[1,1],[1,2]],[[2,0],[2,1],[2,2]],[[0,0],[1,0],[2,0]],[[0,1],[1,1],[2,1]],[[0,2],[1,2],[2,2]],[[0,0],[1,1],[2,2]],[[0,2],[1,1],[2,0]]];for(const s of o){const[[i,e],[t,r],[h,d]]=s,a=n[i][e],c=n[t][r],A=n[h][d];if(a&&a===c&&c===A)return a}return n.flat().every(s=>s!=="")?"draw":null}function M(n){let o=-1/0,s={row:0,col:0};for(let i=0;i<3;i++)for(let e=0;e<3;e++)if(n[i][e]===""){n[i][e]="O";const t=v(n,0,!1);n[i][e]="",t>o&&(o=t,s={row:i,col:e})}return s}const S={X:-1,O:1,draw:0};function v(n,o,s){const i=f(n);if(i)return S[i];if(s){let e=-1/0;for(let t=0;t<3;t++)for(let r=0;r<3;r++)n[t][r]===""&&(n[t][r]="O",e=Math.max(e,v(n,o+1,!1)),n[t][r]="");return e}else{let e=1/0;for(let t=0;t<3;t++)for(let r=0;r<3;r++)n[t][r]===""&&(n[t][r]="X",e=Math.min(e,v(n,o+1,!0)),n[t][r]="");return e}}let l=Array.from({length:3},()=>Array(3).fill("")),u=!1,m=!0,T=!0;const p=document.getElementById("board"),C=document.getElementById("reset"),I=document.getElementById("result-modal"),P=document.getElementById("modal-title"),X=document.getElementById("modal-close"),E=document.getElementById("spinner"),B=document.getElementById("talk"),N=document.getElementById("talk-text"),k=document.getElementById("toggle-sound"),w=document.getElementById("toggle-trash");document.getElementById("theme-toggle");const b=["你這一步下得不錯，但還不夠。","你要認真了嗎。","你有在思考嗎？","這招我已經見過 101 次了。","放棄吧，我是為這個遊戲而生的。","年輕人、有讀書嗎。","哇，居然敢這樣下？"];k.addEventListener("change",()=>{m=k.checked});w.addEventListener("change",()=>{T=w.checked});function y(n){P.textContent=n,I.classList.remove("hidden")}X.addEventListener("click",()=>{I.classList.add("hidden"),O()});function O(){l=Array.from({length:3},()=>Array(3).fill("")),B.classList.add("hidden"),N.textContent="",g()}const L={ai:new Audio("sounds/ai.mp3"),click:new Audio("sounds/click.mp3")};function g(){p.innerHTML="",l.forEach((n,o)=>{n.forEach((s,i)=>{const e=document.createElement("button");e.className=`
        w-[100px] h-[100px]
        text-8xl font-extrabold
        border border-gray-300 dark:border-gray-700
        rounded-xl shadow transition-transform duration-200 ease-in-out
        hover:scale-105 active:scale-95
        ${s==="X"?"text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-800":s==="O"?"text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-800":"text-gray-700 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800"}
        ${s===""?"bg-white dark:bg-gray-900":"bg-transparent"}
      `,e.textContent=s,!s&&!f(l)&&!u&&(e.onclick=async()=>{if(u)return;l[o][i]="X",navigator.vibrate&&navigator.vibrate(50),m&&L.click.play(),g();const t=f(l);if(t)return x(t);if(u=!0,E.classList.remove("hidden"),T){const a=b[Math.floor(Math.random()*b.length)];if(j(a),"speechSynthesis"in window&&m){const c=new SpeechSynthesisUtterance(a);c.lang="zh-TW",speechSynthesis.cancel(),speechSynthesis.speak(c)}}else B.classList.add("hidden");await new Promise(a=>setTimeout(a,1200));const{row:r,col:h}=M(l);l[r][h]="O",navigator.vibrate&&navigator.vibrate(50),m&&L.ai.play(),u=!1,E.classList.add("hidden"),g();const d=f(l);if(d)return x(d)}),p.appendChild(e)})})}function x(n){y(n==="draw"?"平手了！":n==="X"?"你贏了！":"AI 贏了！")}function j(n){const o=document.getElementById("talk"),s=document.getElementById("talk-text");s.textContent=n,o.classList.remove("hidden","animate-fade-out"),o.classList.add("animate-fade-in"),clearTimeout(o._fadeOutTimer),o._fadeOutTimer=setTimeout(()=>{o.classList.remove("animate-fade-in"),o.classList.add("animate-fade-out"),setTimeout(()=>{o.classList.add("hidden")},400)},500)}C.addEventListener("click",O);g();
